/**
 * Cruciverb
 *
 * A JavaScript library that quickly creates interactive,
 * size-responsive, touch-capable crossword puzzles
 * for web pages.
 * 
 * @author Tim Scott Long
 * @copyright Tim Scott Long 2017-2023
 * @license Available for use under the MIT License
 */
let Cruciverb=function(){let e=15,t=function(e){},l=null,r=null,o=!1,n="",s="",a=0,f=30,h=e*f,d="horizontal",c=document.body,u=!1,$=0,p=0,x=[],y=[],w=!1,g=!1,m=null,b=null,_,T=window.location.pathname.substr(window.location.pathname.lastIndexOf("/")+1,window.location.pathname.lastIndexOf(".html")-1-window.location.pathname.lastIndexOf("/"))+"-",S=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],k=[],B={Across:{},Down:{}},A={};for(let v=0;v<S.length;v++)A[S[v]]=0;A.Backtab=0,A.Tab=0,A.Space=0,A.Backspace=0,A.Delete=0,A.Up=0,A.Down=0,A.Left=0,A.Right=0;let E=function(e,t,l,r,o){o.beginPath(),o.moveTo(e,t),o.lineTo(l,r),o.stroke()},I=function(e,t,l,r,o){o.save(),o.shadowColor="rgba(0, 0, 0, 0.35)",o.shadowOffsetX=1,o.shadowOffsetY=1,o.shadowBlur=4,o.fillStyle="rgb(230, 245, 255)",o.fillRect(e-2,t-2,l+4,r+4),o.restore()},R=function(a={}){g||(r=a);let d=a.answers,u=a.clues,$=a.keyHighlights||!0;if(l=this,n=n||a.referenceLinkHref||"",s=s||a.referenceLinkName,g||((c=a.hostElement||c).classList.add("cruciverbHostElm"),c.innerHTML='<div id="topClue_div"></div><canvas id="cruciverb_canvas" width="450" height="450" ></canvas><div id="right_div"><div id="across_div"><h2>Across</h2><ul id="across_ul"></ul></div><div id="down_div"><h2>Down</h2><ul id="down_ul"></ul></div></div><br/><span id="theme_span"></span>',t=a.onrender||function(e){},e=Math.floor(Math.sqrt(a.answers.length)),_=a.oncomplete||a.onComplete||function(){}),void 0!==d){"string"==typeof d&&(d=d.split(""));for(let p=0,y=d.length;p<y;p++)k.push(d[p]),"_"===k[p]?x.push("_"):x.push("")}if(void 0!==u){for(let T in u.Across)B.Across[T]=u.Across[T];for(let S in u.Down)B.Down[S]=u.Down[S]}(void 0!==a.title||void 0!==a.theme)&&(document.getElementById("theme_span").innerHTML="Title: "+(a.title||a.theme)),b=(m=document.getElementById("cruciverb_canvas")).getContext("2d"),h=V(),f=Y(),document.documentElement.clientWidth<=400&&(document.body.style.margin="0",m.style.border="0"),m.style.width="450px",m.style.height="450px",m.setAttribute("width",450),m.setAttribute("height",450),o&&(m.style.width="450px",m.style.height=X()+4*J()+"px",m.setAttribute("width",450),m.setAttribute("height",X()+4*J())),P(),G(),ei(),w=!0,g||(ee(k.indexOf("_")-1),q("across1_li"),m.addEventListener("click",K,!1),window.addEventListener("keydown",N,!1),window.addEventListener("touchstart",C,!1),$&&requestAnimationFrame(L),g=!0)},L=function(){for(let e in A)A[e]>0&&A[e]--;G(),requestAnimationFrame(L)};window.initializeCruciverb=R.prototype.constructor=R,window.addEventListener("resize",initializeCruciverb,!1);let C=function(){m.style.width="450px",m.style.height=450+4*J()+"px",m.setAttribute("width",450),m.setAttribute("height",450+4*J()),o=!0,window.removeEventListener("touchstart",C,!1),initializeCruciverb(),G()};R.prototype.savePuzzle=function(){for(let e=0,t=x.length;e<t;e++)localStorage.setItem(T+"enteredArray["+e+"]",x[e])};let z=R.prototype.getCoordsFromSquare=function(t){return{x:f*(t%e),y:f*Math.floor(t/e)}};R.prototype.getSquareFromCoords=function(t,l){return"object"==typeof t&&(l=t.y,t=t.x),t/=f,l/=f,a=e*l+t};let F=function(){b.fillStyle="black";for(let t=0;t<Math.pow(e,2);t++)"_"==k[t]&&b.fillRect(f*(t%e),f*Math.floor(t/e),f,f)},D=function(){b.fillStyle="black",b.font=Math.max(Math.floor(f/3),5)+"px Arial, sans-serif",b.textBaseline="alphabetic";let t=0;for(let l=0;l<Math.pow(e,2);l++)if("_"!=k[l]&&(l%e==0||l<e||l>=1&&"_"==k[l-1]||l>=e&&"_"==k[l-e])){if(b.fillText(t+1,z(l).x+f/10,z(l).y+Math.max(f/3,5),f/2),y[l]=t+1,!w){if(l%e==0||l>=1&&"_"==k[l-1]){let r=document.createElement("LI");r.id="across"+(t+1)+"_li",document.getElementById("across_ul").appendChild(r),H(l,t,"a")}if(l<e||l>=e&&"_"==k[l-e]){let o=document.createElement("LI");o.id="down"+(t+1)+"_li",document.getElementById("down_ul").appendChild(o),H(l,t,"d")}}t++}},H=function(e,t,l){null!=document.getElementById("across"+(t+1)+"_li")&&"a"==l?(document.getElementById("across"+(t+1)+"_li").innerHTML=t+1+". "+B.Across[t+1],document.getElementById("across"+(t+1)+"_li").addEventListener("click",function(t){d="horizontal",et(e),W(e),q(this.id)},!1)):null!=document.getElementById("down"+(t+1)+"_li")&&"d"==l?(document.getElementById("down"+(t+1)+"_li").innerHTML=t+1+". "+B.Down[t+1],document.getElementById("down"+(t+1)+"_li").addEventListener("click",function(t){d="vertical",et(e),W(e),q(this.id)},!1)):setTimeout(function(){H(t)},100)},q=function(e){let t=document.querySelectorAll("#right_div li");for(let l=0,r=t.length;l<r;l++)t[l].id==e?(t[l].style.backgroundColor="rgb(230, 245, 255)",document.getElementById("topClue_div").innerHTML=t[l].innerHTML):t[l].style.backgroundColor="white"},P=R.prototype.getSavedAnswers=function(){if(window.localStorage)for(i=0,len=k.length;i<len;i++)localStorage.getItem(T+"enteredArray["+i+"]")?x[i]=localStorage.getItem(T+"enteredArray["+i+"]"):"_"!==x[i]&&(x[i]=""),(x[i]+""=="null"||x[i]+""=="undefined")&&(x[i]="")},M=function(e){if("horizontal"==d){q("across"+e+"_li");let t=document.getElementById("across"+e+"_li").offsetTop;document.getElementById("across_div").scrollTop=t}else{q("down"+e+"_li");let l=document.getElementById("down"+e+"_li").offsetTop;document.getElementById("down_div").scrollTop=l}},K=function(t){let l=a,r=m.getBoundingClientRect();if(fingerX=t.clientX-r.left,(fingerY=t.clientY-r.top)>V()){O(fingerX,fingerY-V());return}if(fingerX=Math.floor(fingerX/f),"_"==k[e*(fingerY=Math.floor(fingerY/f))+fingerX])return;(a=e*fingerY+fingerX)==l&&U();let o=a;if("horizontal"==d){for(;"_"!==k[o]&&o%e!=0;)o--;for("_"===k[o]&&o++,j(o),o=a;"_"!==k[o]&&o%e!=e-1;)o++;ee(o)}else{for(;"_"!==k[o]&&o>=0;)o-=e;for(j(o+=e),o=a;"_"!==k[o]&&o<=Math.pow(e,2)-1;)o+=e;ee(o)}G(),M(y[Z()])},O=function(e,t){let l={preventDefault:function(){},which:0,shiftKey:!1},r=J();V(),b.font=Math.floor(r/2)+"px Arial, sans-serif",t<=r?e<r?l.which=81:e<2*r?l.which=87:e<3*r?l.which=69:e<4*r?l.which=82:e<5*r?l.which=84:e<6*r?l.which=89:e<7*r?l.which=85:e<8*r?l.which=73:e<9*r?l.which=79:l.which=80:t<=2*r?e<r+r/2?l.which=65:e<2*r+r/2?l.which=83:e<3*r+r/2?l.which=68:e<4*r+r/2?l.which=70:e<5*r+r/2?l.which=71:e<6*r+r/2?l.which=72:e<7*r+r/2?l.which=74:e<8*r+r/2?l.which=75:l.which=76:t<=3*r?e<r?(l.which=9,l.shiftKey=!0):e<2*r?l.which=90:e<3*r?l.which=88:e<4*r?l.which=67:e<5*r?l.which=86:e<6*r?l.which=66:e<7*r?l.which=78:e<8*r?l.which=77:e<9*r?l.which=38:l.which=9:e<2.5*(2*r/3)?l.which=8:e<5.5*(2*r/3)?l.which=46:e<10.5*(2*r/3)?l.which=32:e<10.5*(2*r/3)+r?l.which=37:e<10.5*(2*r/3)+2*r?l.which=40:l.which=39,N(l)},W=function(t){if("horizontal"==d){for(;"_"!=k[t]&&t%e!=0;)t--;for("_"==k[t]&&t++,j(t),t=a;"_"!=k[t]&&t%e!=e-1;)t++;ee(t)}else{for(;"_"!=k[t]&&t>=0;)t-=e;for(j(t+=e),t=a;"_"!=k[t]&&t<=Math.pow(e,2)-1;)t+=e;ee(t)}G()},N=R.prototype.keyHit=function(t){switch(t.preventDefault(),t.which){case 37:if(A.Left=10,0==a)a=k.length-1;else do a--;while("_"===k[a]);break;case 39:A.Right=10,window.answerArray=k;do a++,a%=k.length;while("_"===k[a]);break;case 38:A.Up=10;do a<e&&(a+=k.length),a-=e;while(a<0||"_"===k[a]);break;case 40:A.Down=10;do a>k.length-1-Math.floor(Math.sqrt(k.length))&&(a-=Math.pow(e,2)),a+=e;while(a>k.length||"_"===k[a]);break;case 32:A.Space=10,U();break;case 8:if(A.Backspace=10,"horizontal"==d){if(""===x[a]&&a>0)do a--;while("_"===k[a]&&a>0)}else if(""===x[a]&&a>=e)do a-=e;while("_"===k[a]&&a>=e);x[a]="",localStorage.setItem(T+"enteredArray["+a+"]","");break;case 46:A.Delete=10,x[a]="",localStorage.setItem(T+"enteredArray["+a+"]","");break;case 9:if(t.shiftKey){if(A.Backtab=10,0==a)a=k.length-1;else do a--;while((a%e!=0||"_"===k[a])&&("_"!==k[a-1]||"_"===k[a]))}else if(A.Tab=10,a==k.length-1)a=0;else do a++,a%=k.length;while((a%e!=0||"_"===k[a])&&("_"!==k[a-1]||"_"===k[a]));break;default:if(t.which>=65&&t.which<=90){if(x[a]=S[t.which-65],A[S[t.which-65]]=10,localStorage.setItem(T+"enteredArray["+a+"]",x[a]),"horizontal"==d)do a++,a%=k.length;while("_"===k[a]||"block"===k[a]);else do a>k.length-1-Math.sqrt(k.length)&&(a-=Math.pow(e,2)),a+=e;while("_"===k[a])}}G(),W(a),M(y[Z()]),Q()&&!u&&(er(),_.call(l))},U=R.prototype.toggleDirection=function(){d="horizontal"==d?"vertical":"horizontal"},V=R.prototype.getPuzzleWidth=function(){let t=Math.floor(Math.min(document.documentElement.clientWidth,450));for(;t%e!=0;)t--;return t},X=R.prototype.getPuzzleHeight=function(){return V()},Y=R.prototype.getSquareWidth=function(){return Math.floor(Math.min(V(),document.documentElement.clientWidth)/e)},J=function(){return Math.min(Math.min(45,Math.floor(3*f/2)),Math.floor(V()/10))},G=function(){b.clearRect(0,0,m.width,m.height),b.fillStyle="#FFFFAA",b.fillStyle="rgb(255, 255, 230)","horizontal"==d?b.fillRect(f*(Z()%e),f*Math.floor(Z()/e),el()*f,f):b.fillRect(f*(Z()%e),f*Math.floor(Z()/e),f,el()*f),b.strokeStyle="black";let l=V(),r=Y();for(let o=0;o<=l;o+=r)E(o,0,o,l,b),E(0,o,l,o,b);F(),D(),b.strokeStyle="rgb(0, 0, 200)",b.strokeRect(f*(a%e),f*Math.floor(a/e),f,f),b.font=Math.floor(f/2)+"px Arial, sans-serif",b.textBaseline="middle";for(let n=0;n<k.length;n++)"_"!=x[n]&&b.fillText(x[n]||"",z(n).x+f/2-b.measureText(x[n]||"").width/2,z(n).y+f/2);let s=["Q","W","E","R","T","Y","U","I","O","P","A","S","D","F","G","H","J","K","L","Z","X","C","V","B","N","M"],h=J(),c=V();b.font=Math.floor(.5*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillStyle="rgb(245, 250, 255)",b.fillRect(0,c,c,4*h),b.fillStyle="rgb(25, 25, 25)",b.strokeStyle="rgb(230, 245, 255)";for(let u=0;u<10;u++)b.strokeRect(u*h,c,h,h),A[s[u]]>0?(I(u*h,c,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText(s[u],u*h+h/2-b.measureText(s[u]).width/2,c+h/2)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText(s[u],u*h+h/2-b.measureText(s[u]).width/2,c+h/2));b.fillStyle="rgb(25, 25, 25)",b.strokeStyle="rgb(230, 245, 255)",b.font=Math.floor(.5*f)+"px Arial, sans-serif";for(let $=0;$<9;$++)b.strokeRect(f/2+$*h,c+h,h,h),A[s[$+10]]>0?(I(f/2+$*h,c+h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText(s[$+10],f/2+$*h+h/2-b.measureText(s[$+10]).width/2,c+3*h/2)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText(s[$+10],f/2+$*h+h/2-b.measureText(s[$+10]).width/2,c+3*h/2));for(let p=0;p<7;p++)b.strokeRect((p+1)*h,c+2*h,h,h),A[s[p+19]]>0?(I((p+1)*h,c+2*h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText(s[p+19],(p+1)*h+h/2-b.measureText(s[p+19]).width/2,c+5*h/2)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText(s[p+19],(p+1)*h+h/2-b.measureText(s[p+19]).width/2,c+5*h/2));b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.strokeRect(0,c+2*h,h,h),A.Backtab>0?(I(0,c+2*h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("\xab",h/2-b.measureText("\xab").width/2,c+2*h+h/2)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("\xab",h/2-b.measureText("\xab").width/2,c+2*h+h/2)),b.strokeRect(9*h,c+2*h,h,h),A.Tab>0?(I(9*h,c+2*h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("\xbb",9*h+h/2-b.measureText("\xbb").width/2,c+2*h+h/2)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("\xbb",9*h+h/2-b.measureText("\xbb").width/2,c+2*h+h/2)),b.strokeRect(0,c+3*h,2.5*(2*h/3),h),A.Backspace>0?(I(0,c+3*h,2.5*(2*h/3),h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("BKSP",(h+2*h/3)/2-b.measureText("BKSP").width/2,c+3*h+h/2)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("BKSP",(h+2*h/3)/2-b.measureText("BKSP").width/2,c+3*h+h/2)),b.strokeRect(2.5*(2*h/3),c+3*h,3*(2*h/3),h),A.Delete>0?(I(2.5*(2*h/3),c+3*h,3*(2*h/3),h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("DEL",h+2*h/3+(h+h)/2-b.measureText("DEL").width/2,c+3*h+h/2)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("DEL",h+2*h/3+(h+h)/2-b.measureText("DEL").width/2,c+3*h+h/2)),b.strokeRect(8*h,c+2*h,h,h),A.Up>0?(I(8*h,c+2*h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("↑",8.5*h-b.measureText("↑").width/2,c+2.5*h)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("↑",8.5*h-b.measureText("↑").width/2,c+2.5*h)),b.strokeRect(10.5*f,c+3*h,h,h),A.Left>0?(I(10.5*f,c+3*h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("←",7.5*h-b.measureText("←").width/2,c+3.5*h)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("←",7.5*h-b.measureText("←").width/2,c+3.5*h)),b.strokeRect(10.5*f+h,c+3*h,h,h),A.Down>0?(I(10.5*f+h,c+3*h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("↓",8.5*h-b.measureText("↓").width/2,c+3.5*h)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("↓",8.5*h-b.measureText("↓").width/2,c+3.5*h)),b.strokeRect(10.5*f+2*h,c+3*h,h,h),A.Right>0?(I(10.5*f+2*h,c+3*h,h,h,b),b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.6*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("→",9.5*h-b.measureText("→").width/2,c+3.5*h)):(b.fillStyle="rgb(25, 25, 25)",b.font=Math.floor(.35*h)+"px Arial, sans-serif",b.textBaseline="middle",b.fillText("→",9.5*h-b.measureText("→").width/2,c+3.5*h)),b.strokeRect(5.5*(2*h/3),c+3*h,5*(2*h/3),h),A.Space>0&&I(5.5*(2*h/3),c+3*h,5*(2*h/3),h,b),t(b)},Q=R.prototype.isComplete=function(){for(let e=0;e<k.length;e++)if(k[e]!=x[e])return!1;return!0},Z=R.prototype.getHighlightStart=function(){return $},j=R.prototype.setHighlightStart=function(e){$=e};R.prototype.getHighlightEnd=function(){return p};let ee=R.prototype.setHighlightEnd=function(e){p=e};R.prototype.getPlayerSquarePos=function(){return a};let et=R.prototype.setPlayerSquarePos=function(e){a=e,G()},el=R.prototype.getHighlightLength=function(){return"horizontal"===d?p-$+1:(p-$+1)/e};R.prototype.clearBoard=function(){for(let e=0;e<x.length;e++)"_"!=x[e]&&(x[e]="",localStorage.setItem(T+"enteredArray["+e+"]",""));initializeCruciverb({})},R.prototype.showAllAnswers=function(){for(let e=0;e<k.length;e++)x[e]=k[e],G()};let ei=function(){let e=document.createElement("DIV"),t=document.createElement("DIV"),l=document.createElement("H2"),r=document.createTextNode("Puzzle Completed");document.createTextNode("&times;"),e.id="shadow_div",t.id="results_div",l.appendChild(r),t.appendChild(l),e.style.width="100%",e.style.height=document.documentElement.clientHeight+"px",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(80, 80, 80, 0.3)",t.style.height="320px",t.style.backgroundColor="rgba(40, 40, 40, 0.8)",l.style.backgroundColor="transparent",l.style.width="90%",l.style.color="white",l.style.padding="0 5px",t.style.color="white",t.style.position="absolute",document.documentElement.clientWidth<=400?(t.style.width="100%",t.style.top="40px",t.style.left="0"):(t.style.width="300px",t.style.top="40px",t.style.left="40px"),t.style.margin="0 auto",c.appendChild(e),c.appendChild(t)},er=R.prototype.showResults=function(){u=!0;let e=document.getElementById("results_div");-1===e.innerHTML.indexOf("Check")?e.innerHTML+="<br/><br/>&nbsp;Check out more of our puzzles online!<br/><br/><br/>&nbsp;<strong><a href='"+n+"' style='color: white; text-decoration: none;'>"+s+"</a></strong><br/><br/><br/><br/>&nbsp;<small>JS crossword library by timlongcreative.com</small>":e.innerHTML+="<br/><br/><br/>&nbsp;&nbsp;&nbsp;Well done!",document.getElementById("shadow_div").style.display="block",e.style.display="block"};return R.prototype.enterFullScreen=function(e){void 0===e&&(e=document.documentElement),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},R.prototype.exitFullScreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},R}();